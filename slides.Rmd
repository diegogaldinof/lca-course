---
title: "Introduction to Latent Class Analysis"
author: "Diego Galdino França"
date: "January 6, 2022"
institution: "GEMINI"
output:
  xaringan::moon_reader:
    seal: true
    css: css/custom-en.css
    lib_dir: libs
    nature:
      slideNumberFormat: "%current%"
      highlightStyle: tango
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: false
---


  
```{r setup, include=FALSE, eval=TRUE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  eval = TRUE,
  fig.align = "center",
  message = FALSE,
  warning = FALSE,
  echo = TRUE
)
```

```{r xaringanExtra, include=FALSE, eval=TRUE}
xaringanExtra::use_tile_view()
htmltools::tagList(
  xaringanExtra::use_clipboard(
    button_text = "<i class=\"fa fa-clipboard\"></i>",
    success_text = "<i class=\"fa fa-check\" style=\"color: #90BE6D\"></i>"),
  rmarkdown::html_dependency_font_awesome()
)
xaringanExtra::use_extra_styles(hover_code_line = TRUE,
                                mute_unhighlighted_code = FALSE)
xaringanExtra::use_broadcast()
xaringanExtra::use_freezeframe()
```

```{r packages, include=FALSE, eval=TRUE}
library(tidyverse)
library(gtsummary)
library(huxtable)
library(emo)
```



# (Finite) Mixture Models

> (Finite) Mixture Models are a family of statistical procedures for uncovering hidden groups.

<br>

`r emo::ji("target")` To provide a **probabilistic classification** of persons to latent classes based on a __statistical model__.

---

IMAGEM DO MODELO

---

IMAGEM DO PROBABILISTIC

---

imagem do LPA

---

IMAGEM DO LCA

---


# Latent Class Analysis

> The main goal of LCA is to identify groups, called latent classes, based on responses to a set of observed indicators ([Nylung-Gibson & Choi, 2018](https://www.statmodel.com/download/LCAFAQ.pdf)).

- Applied to cross-sectional data.

- Uses responses to a chosen set of indicators to __identify groups of people__ that are __alike__ each other.

- Categorical (usually binary) indicators.

  - **Exploratory**: uncover hidden group based on data;
  
  - **Confirmatory**: test for the equivalence of latent class solutions.

---

#### Assumption

The assumption underlying LCA is that membership in unobserved classes can __cause or explain__ patterns of scores across indicators.

- Inside of a class, the correlations between the indicators become zero.

--

#### LCA researchers must:

- interpret classes theoretically;

- explain the implications of class membership for practice.

--

#### Validation

Determine if class assignments are related as expected to relevant outcomes.

---

## Cluster analysis *vs* LCA


.pull-left[

<center><strong>Cluster analysis</strong></center>

- The cases with the most similar scores belong in the same __cluster__.

- Variables should be __continuous__ (means).

- Case membership in clusters is __determined__ in cluster analysis.

]


.pull-right[

<center><strong>LCA</strong></center>

- __Latent classes__ exist and explain patterns of observed scores across cases.

- Variables are __categorical__ (cross-tabulation).

- __Probabilities__ of class membership are obtained, not clear-cut assignments.

]

---

## Software

There are some softwares which can run LCA:

- __MPLUS__

- __Latent GOLD__

- __STATA__

- __SAS__

- __R__

--
`r emo::ji("thumbsup")`


---

## poLCA

[poLCA](https://cran.r-project.org/web/packages/poLCA/poLCA.pdf) is a package to perform Latent Class Analysis with polytomous variable.

It has a simple, friendly syntax and does almost everything we need by now.

```{r eval = FALSE}
install.packages("poLCA")
library(poLCA)
```


---

# Steps to perform LCA

Let's dive into a practical example!

The dataset `pd` comes from [Richter et al. (2013).](https://econtent.hogrefe.com/doi/full/10.1024/1010-0652/a000104)


```{r}
library(tidyverse)
library(knitr)
pd <- read.table("dataset_pd.txt", header = TRUE)[-9]
knitr::kable(head(pd, 3))
```


---

There are eight binary variables (no = 1; yes = 2) indicating teachers’ participation in professional development (PD) courses on several topics during the last five years:

.pull-left[

- Content knowledge (CK)

- Pedagogical content knowledge (PCK)

- Teaching and learning methods (TLM)

- Teaching heterogeneous students (THS)

]

.pull-right[

- Classroom management and discipline (CMD)

- Individualized learning support (ILS)

- Counseling students and parents (CSP)

- Knowledge of kids and youth (KKY)


]


---

## Sample size

To date, there are __no concrete guidelines__ for sample size for LCA models.

<br>

> Sample size of __300-1000__ is roughly the range in which most commonly used fit indices for mixture models can be expected to function adequately ([Nylung-Gibson & Choi, 2018.](https://www.statmodel.com/download/LCAFAQ.pdf))


---

Mininum sample size in LCA depends on several conditions:

- number of indicators included in the model;

- how well the indicators differentiate classes;

- how well-separated the classes are; 

- the relative sizes of the classes.

<br>

--

```{r}
nrow(pd)
```



---

## Exploratory Data Analysis

As in all the data analysis processes, it's important to start exploring the data.

__Frequency table__

```{r}
library(gtsummary)
pd %>%
  purrr::map_df(factor, levels = c(1, 2), labels = c("No", "Yes")) %>%
tbl_summary()
```


---

__Bar plot__

```{r}
freq <- apply(X = pd, MARGIN = 2, FUN = table)
barplot(freq, beside = TRUE, legend = c("No", "Yes"),
main = "Participation in PD activities")
```



---

__Tetrachoric correlation__

Suitable correlation coefficient for binary/dichotomous variables.

<br>

> It makes only sense to apply LPA/LCA if the set of indicators is inter-correlated ([Bauer, 2021.](https://psyarxiv.com/97uab/))


---

```{r}
library(correlation)
corr <- correlation(pd, method = "auto", include_factors = TRUE) %>%
  summary(redundant = FALSE) %>% visualisation_recipe(show_data = "tile")
plot(corr) + theme_minimal() + theme(panel.grid = element_blank())
```


---

## Model specification

> Researchers need to make a __theory-based selection of observed indicators__ ([Bauer, 2021.](https://psyarxiv.com/97uab/))

> Although researchers can use LCA as an exploratory statistical approach, __theory should guide__ the choice of indicator variables ([Weller et al., 2020.](https://journals.sagepub.com/doi/full/10.1177/0095798420930932))

> Item choice in an LCA should be motivated by __well-defined research questions__ ([Nylung-Gibson & Choi, 2018.](https://www.statmodel.com/download/LCAFAQ.pdf))


---

### Specifying the model in the poLCA package

We need to select the indicators and create a formula with them:

```{r}
my_formula <- cbind(CK, PCK, TLM, THS, CMD, ILS, CSP, KKY) ~ 1
```

The `~ 1` indicates we __don't__ want to estimate a model with covariates.

This formula will be used soon, as an argument in the function `poLCA()`.

---

## Class enumeration

In this step, we need to decide on the number of classes of our model.

The goal is to yield a solution that balances __model parsimony__ and __fit__, and that delivers substantively __interpretable classes__.

--

**The standard procedure**

1. Estimate a one-class model.

2. Estimate models with one additional class at a time.

3. Compare the models based on statistical and substantive criteria.

4. Continue to run models with one additional class until the best model is identified.



---

#### \#1

```{r eval = FALSE}
set.seed(42)

lca1 <- poLCA(formula = my_formula, data = pd, nclass = 1, maxiter = 5000, nrep = 100)
lca2 <- poLCA(formula = my_formula, data = pd, nclass = 2, maxiter = 5000, nrep = 100)
lca3 <- poLCA(formula = my_formula, data = pd, nclass = 3, maxiter = 5000, nrep = 100)
lca4 <- poLCA(formula = my_formula, data = pd, nclass = 4, maxiter = 5000, nrep = 100)
lca5 <- poLCA(formula = my_formula, data = pd, nclass = 5, maxiter = 5000, nrep = 100)
lca6 <- poLCA(formula = my_formula, data = pd, nclass = 6, maxiter = 5000, nrep = 100)
```

---

#### \#2

```{r eval = FALSE}
set.seed(42)
n_class <- 6
lca_models <- list()
for (i in seq_len(n_class)) {
        lca_models[i] <- poLCA::poLCA(formula = my_formula,
                                      data = pd,
                                      nclass = i,
                                      maxiter = 5000,
                                      nrep = 100)
}
```


### Statistical criteria (fit indices)

sd